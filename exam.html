<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EDAI Tutor Exam Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { background-color:#f7f8fc; font-family:'Segoe UI',sans-serif; }
    .exam-container { max-width:900px; margin:40px auto; padding:20px; background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.08); }
    .question-card { background:#fff; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.05); }
    .btn-check-answer { background-color:#0d6efd; color:white; margin-top:10px; }
    .btn-check-answer:hover { background-color:#084298; }
    .answer { margin-top:10px; font-style:italic; }
    .explanation-box { background:#eef6ff; border-left:4px solid #0d6efd; padding:10px 15px; margin-top:10px; border-radius:6px; display:none; }
    .ref-link { display:block; margin-top:3px; }
  </style>
</head>

<body>
  <div class="exam-container">
    <h2 class="text-center fw-bold mb-2">EDAI Tutor Exam Generator</h2>
    <p class="text-center text-muted mb-4">ACEM / RCEM / RNZCUC / Associateship Mock Exam Practice</p>
    <div id="load-error" class="text-danger mb-3" style="display:none;"></div>
    <div id="questions-list"></div>
    <div class="text-center">
      <button id="load-more" class="btn btn-primary" style="display:none;">Load 20 More Questions</button>
    </div>
  </div>

<script>
const QUESTIONS_URL = 'questions_bank.json';
const EXPLANATIONS_URL = 'explanations_bank.json';

let allQuestions = [];
let explanations = {};
let rendered = 0;
const PAGE_SIZE = 20;

async function loadBanks() {
  try {
    const [qRes, eRes] = await Promise.all([
      fetch(QUESTIONS_URL, { cache:'no-store' }),
      fetch(EXPLANATIONS_URL, { cache:'no-store' })
    ]);
    if (!qRes.ok || !eRes.ok) throw new Error('fetch error');
    allQuestions = await qRes.json();
    explanations = await eRes.json();
    document.getElementById('load-error').style.display = 'none';
    renderNextPage(true);
  } catch (err) {
    console.error(err);
    const errBox = document.getElementById('load-error');
    errBox.textContent = 'Failed to load questions or explanations. Please check file paths.';
    errBox.style.display = 'block';
  }
}

function renderNextPage(reset=false) {
  const list = document.getElementById('questions-list');
  if (reset) { list.innerHTML=''; rendered=0; }
  const slice = allQuestions.slice(rendered, rendered+PAGE_SIZE);
  slice.forEach((q,i)=>list.appendChild(renderQuestionCard(q,rendered+i+1)));
  rendered += slice.length;
  document.getElementById('load-more').style.display = (rendered < allQuestions.length) ? 'inline-block' : 'none';
}

function renderQuestionCard(q, num) {
  const card = document.createElement('div');
  card.className='question-card';
  const title=document.createElement('h5');
  title.textContent=`Q${num}. ${q.stem}`;
  card.appendChild(title);

  q.options.forEach((opt,idx)=>{
    const lbl=document.createElement('label');
    lbl.style.display='block';
    lbl.innerHTML=`<input type="radio" name="q${num}" value="${idx}"> ${opt}`;
    card.appendChild(lbl);
  });

  const btn=document.createElement('button');
  btn.className='btn btn-sm btn-check-answer';
  btn.textContent='Check';
  btn.onclick=()=>checkAnswer(num,q);
  card.appendChild(btn);

  const ans=document.createElement('div');
  ans.id=`ans${num}`;
  ans.className='answer';
  card.appendChild(ans);

  const exp=document.createElement('div');
  exp.id=`exp${num}`;
  exp.className='explanation-box';
  card.appendChild(exp);
  return card;
}

function checkAnswer(num,q){
  const sel=document.querySelector(`input[name="q${num}"]:checked`);
  const ans=document.getElementById(`ans${num}`);
  const exp=document.getElementById(`exp${num}`);
  if(!sel){ ans.textContent='Select an option first.'; ans.classList.add('text-danger'); return;}
  const chosen=parseInt(sel.value);
  const correct=chosen===q.answer_index;
  ans.textContent=correct?'âœ… Correct!':'âŒ Incorrect.';
  ans.className=correct?'answer text-success':'answer text-danger';
  const expData=explanations[q.id];
  if(expData){
    let refs='';
    expData.sources.forEach(r=>{
      refs+=r.url?`<a href="${r.url}" target="_blank" class="ref-link">ðŸ”— ${r.title}</a>`:`<span class="ref-link">ðŸ“˜ ${r.title}</span>`;
    });
    exp.innerHTML=`<b>Short Explanation:</b> ${expData.text}<br><b>References:</b><br>${refs}`;
  }else if(q.explanation){ exp.innerHTML=`<b>Explanation:</b> ${q.explanation}`; }
  exp.style.display='block';
}

document.getElementById('load-more').addEventListener('click',()=>renderNextPage(false));
loadBanks();
</script>
</body>
</html>



